{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2><i class="fas fa-tachometer-alt"></i> Dashboard Admin</h2>
        <p class="text-light">
            Halo, {{ current_user.username }}
            <span class="badge"
                style="background: var(--primary-light); color: var(--primary-dark); padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">
                {{ current_user.role|upper }}
            </span>
        </p>
    </div>

    <!-- Transcripts Section -->
    <h3 class="mb-4">Data Transkrip</h3>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Kode</th>
                    <th>Nama Partisipan</th>
                    <th>Oleh Admin</th>
                    <th>Waktu</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for t in transcripts %}
                <tr>
                    <td>{{ t.participant_code }}</td>
                    <td>{{ t.participant_name }}</td>
                    <td>{{ t.user.username }}</td>
                    <td>{{ t.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>
                        <a href="{{ url_for('main.download_transcript', transcript_id=t.id) }}"
                            class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;"
                            title="Download TXT">
                            <i class="fas fa-file-alt"></i> TXT
                        </a>
                        <a href="{{ url_for('main.download_transcript_docx', transcript_id=t.id) }}"
                            class="btn btn-success" style="padding: 0.5rem 1rem; font-size: 0.9rem;"
                            title="Download Word">
                            <i class="fas fa-file-word"></i> Word
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center">Belum ada data transkrip.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- User Management Section (Admin III Only) -->
    {% if current_user.role == 'admin_iii' %}
    <h3 class="mb-4 mt-4" style="margin-top: 3rem;">Manajemen User</h3>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Role Saat Ini</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td>{{ u.username }}</td>
                    <td>{{ u.role }}</td>
                    <td>
                        {% if u.role == 'admin_i' %}
                        <form action="{{ url_for('main.upgrade_user', user_id=u.id) }}" method="POST"
                            style="display: inline;">
                            <button type="submit" class="btn btn-primary"
                                style="padding: 0.5rem 1rem; font-size: 0.9rem;"
                                onclick="return confirm('Yakin ingin upgrade user ini ke Admin Boss?')">
                                <i class="fas fa-arrow-up"></i> Upgrade ke Boss
                            </button>
                        </form>
                        {% elif u.role == 'admin_ii' %}
                        <span class="text-light">Sudah Boss</span>
                        {% else %}
                        <span class="text-light">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>
{% endblock %}